name: ci
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      - name: Set up Ruby
        uses: ruby/setup-ruby@v1
        with:
          bundler-cache: true
      - name: Create credentials file
        run: |
          mkdir -p spec/support
          cat > spec/support/credentials.json << EOF
          {
            "access_key_id": "${{ secrets.AWS_ACCESS_KEY_ID }}",
            "secret_access_key": "${{ secrets.AWS_SECRET_ACCESS_KEY }}",
            "region": "${{ secrets.AWS_REGION }}"
          }
          EOF
      - name: Run tests
        run: bundle exec rake
